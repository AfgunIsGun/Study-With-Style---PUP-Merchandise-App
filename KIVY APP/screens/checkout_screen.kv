from kivy.app import App
from kivy.uix.screenmanager import Screen

class CheckoutScreen(Screen):
    def on_pre_enter(self, *args):
        self.update_order_summary()

    def update_order_summary(self):
        app = App.get_running_app()
        cart = app.cart
        if not cart:
            self.ids.order_summary.text = "Your cart is empty."
            return

        total_price = 0
        summary_lines = []
        for item in cart:
            product = app.get_product_by_id(item['product_id'])
            if product:
                line = f"{product['name']} x {item['quantity']} = ₱{product['price'] * item['quantity']:.2f}"
                summary_lines.append(line)
                total_price += product['price'] * item['quantity']

        summary_text = "\n".join(summary_lines)
        summary_text += f"\n\nTotal: ₱{total_price:.2f}"
        self.ids.order_summary.text = summary_text